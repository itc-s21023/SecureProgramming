# 4-5 
## クロスサイト・リクエストフォージェリ(CSRF)の攻撃手法とその理屈  
- 入力-実行パターンのCSRF攻撃  
	1. 攻撃者が罠(悪意のあるリンク)を用意し、インターネット上に配置する  
	1. 被害者が罠(悪意のあるリンク)をクリックすることで、攻撃用のリクエストが発行される  
	1. 被害者のブラウザが攻撃先のサーバにリクエストを送信する  
	1. 攻撃先のサーバがリクエストを正しいものと認識してしまう  
	1. パスワードの変更といった不正な操作が行われる  
- 確認がある場合のCSRF攻撃  
	- hiddenパラメータでパラメータを受け渡ししている場合  
		1. 攻撃者が罠(悪意のあるリクエスト 例(hiddenフィールドを使用して、パスワードを変更するリクエスト))をフォームに埋め込むなどの用意する  
		1. 被害者が罠(悪意のあるリクエスト)のリンクやフォームをクリック、送信することで、攻撃用のリクエストが発行される  
		1. 攻撃者が確認用のリンクやフォームから取得した情報を元に、攻撃用リクエストを送信する  
		1. 攻撃先のサーバがリクエストを正しいものと認識してしまう  
		1. パスワードの変更といった不正な操作が行われる  
	- セッション変数によりパラメータ受け渡ししている場合  
		1. 攻撃者が罠(悪意のあるリクエスト 例(攻撃用のリクエストをセッション変数に格納))を用意する  
		1. 被害者が罠(悪意のあるリクエスト)のリンクやフォームをクリック、送信することで、攻撃用のリクエストがセッション変数から取得され、サーバに送信される  
		1. サーバが攻撃用のリクエストを実行する  
		1. パスワードの変更といった不正な操作が行われる  
- ファイルアップロードフォームでのCSRF攻撃  
	1. 攻撃者が罠(攻撃用のファイルアップロードフォーム)を用意する  
	1. 被害者がファイルアップロードフォームを送信すると、ファイルがサーバにアップロードされる  
	1. サーバが処理を行うが、悪意のあるファイルが保存されてしまう  
	1. 不正な操作が行われる
## 対策  
- CSRF対策の必要なページを区別する  
- 正規利用者の意図したリクエストを確認できるよう実装する  
- CSRFトークンを導入する  
	- サーバが生成したトークンを攻撃者は知ることができない  
- Refterのチェック  
	- Refterをチェックし、リクエストが同一のものであるか確認できる  
- パスワードの再入力  
	- 正規の利用者であるか確認できる  

